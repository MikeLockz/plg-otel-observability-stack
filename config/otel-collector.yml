receivers:
  hostmetrics:
    root_path: /hostfs
    collection_interval: 30s
    scrapers:
      cpu:
      disk:
      filesystem:
      load:
      memory:
      network:
      paging:
      processes:
  docker_stats:
    endpoint: unix:///var/run/docker.sock
    collection_interval: 20s
  filelog:
    include:
      - /var/lib/docker/containers/*/*.log
    start_at: end
    include_file_path: true
    include_file_name: false
    operators:
      - type: json_parser
        timestamp:
          parse_from: time
          layout: '%Y-%m-%dT%H:%M:%S.%LZ'
      - type: move
        from: log
        to: body
  otlp:
    protocols:
      grpc:
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318

exporters:
  prometheus:
    endpoint: 0.0.0.0:8889
    namespace: otel
    resource_to_telemetry_conversion:
      enabled: true
  
  otlphttp/loki:
    endpoint: "http://loki:3100/loki/api/v1/push"
    tls:
      insecure: true

  otlp/tempo:
    endpoint: "tempo:4317"
    tls:
      insecure: true

    tls:
      insecure: true

processors:
  batch:
  filter/debug:
    error_mode: ignore
    logs:
      log_record:
        - 'body matches "(?i)debug"'

service:
  pipelines:
    traces:
      receivers: [otlp]
      processors: [batch]
      exporters: [otlp/tempo]
    metrics:
      receivers: [otlp, hostmetrics, docker_stats]
      processors: [batch]
      exporters: [prometheus]
    logs:
      receivers: [otlp, filelog]
      processors: [batch, filter/debug]
      exporters: [otlphttp/loki]
